# [kyivrockets](https://t.me/kyivrockets)
Юзербот для сповіщень про ракети на Київ

По змінних (* - значить варто її змінити): 
- \* API_ID та API_HASH для юзербота - брати на [my.telegram.org](https://my.telegram.org). Також там варто задати зрозуміле для себе ім'я "застосунку" - воно буде в активних сесіях telegram з оновленням часу останнього відвідування не рідше разу на день.
- \* BOT_TOKEN для звичайного бота - в [@botfather](https://t.me/botfather). Звичайний бот потрібний для того, щоб самому отримувати сповіщення (я взагалі-то для себе і писав). Очевидно, він має права писати в каналі.
- SOURCE_CHANNELS - я дійшов до того, що по Києву (і автоматично області) достатньо двох - офіційного [@kpszsu](https://t.me/kpszsu) і найпершого [@war_monitor](https://t.me/war_monitor). Решта або повільніші і просто дублюють, або менш точні, або непридатні для парсингу, або часом пропускають (жахаюча більшість таких каналів - помийки).
Для інших міст/областей можна спробувати вказати (додати) свої місцеві, але малоімовірно, що буде ефективніше в розрізі хоча б двох атак. Менше каналів - менше шансів отримати бан за юзербота, менше навантаження. На ці канали треба бути підписаним (можна кинути в архів).
- \* TARGET_CHANNEL - очевидно, калал "куди". В ньому я увімкнув сповіщення і дозвіл в режимі DND.
- KEYWORDS_GROUP1 - дослідним шляхом встановлено такі. В інших каналах можуть бути по-іншому.
- \* KEYWORDS_GROUP2 - слова що описують ваше місто/область. Важливо обрізати можливі різні закінчення.
- STOP_WORDS - слова, що зустрічаються в повідомленнях з словами з перших двох груп, але ці повідомлення не варто надсилати. Наприклад, причини тривоги, звіти, інофрмаційне. Тут точно  варто додавати свої виключення при використанні інших джерел.

На великих каналах telegram часом тупить з events.NewMessage і дає або суттєву затримку, або взагалі не дає подію. Так як сервіс крітікал, то є підстраховка в вигляді GetHistoryRequest. Дублювання нема. Можна змінити sleep(5) - кількість секунд, через які знову буде опитувати. Для двох каналів 5 - норм, для великої кількості - треба більше. Значення не вираховується, а відчувається на рівні інтуїції.

Логіка - якщо в повідомленні є слово з групи 1 і є слово з групи 2 і нема стоп-слів, то бот напише це повідомлення в канал.

Так як пише бот, то повідомлення не можуть пересилатись, а пишуться нові у вигляді повної копії тексту з клікабельним посиланням на джерело. 

Є фільтр на http-код відповіді серверу, ловляться всякі винятки, проблеми підключення і т.д, бот працює 24/7. Розроблялось під Python 3.12.

telegram не заохочує використання юзерботів, тому будьте готові отримати бан. Проте якщо не зловживати і використовувати реальний акаунт (якому трохи є років), то, як пишуть, імовірність дуже мала.
